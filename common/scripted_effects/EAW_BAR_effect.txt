@BAR_EXPEDITION_MAX_EQUIPMENT_LEVEL = 5;

bar_load_sane_ambrosius = {
	clr_country_flag = barrad_early_game
	remove_ideas = BAR_pentarchy
	add_country_leader_role = {
		character = BAR_angrier_mob
		promote_leader = yes
		country_leader = {
			expire = "1965.1.1"
			ideology = kratokracy
		}
	}
	set_politics = {
		ruling_party = neutrality
	}
	set_party_name = {
		ideology = neutrality
		name = BAR_ambrosius_party_name
		long_name = BAR_ambrosius_party_name
	}
	add_country_leader_role = {
		character = BAR_count_ambrosius
		promote_leader = yes
		country_leader = {
			expire = "1965.1.1"
			ideology = despotism
			traits={ BAR_benevolent_ruler }
		}
	}
	load_focus_tree = barrad_focus_tree_sane_ambrosius
}

BAR_happy_ending = {
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = barrad_asinti_alive
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_leopold_alive
				has_country_flag = barrad_viira_alive
				NOT = {
					has_completed_focus = BAR_search_for_knowledge
				}
				NOT = {
					has_country_flag = BAR_begun_friendship_path
				}
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 70
					compare = greater_than_or_equals
				}
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 70
					compare = greater_than_or_equals
				}
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 70
					compare = greater_than_or_equals
				}
				check_variable = {
					var = BAR_relations_silver_viira
					value = 70
					compare = greater_than_or_equals
				}
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 70
					compare = greater_than_or_equals
				}
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 70
					compare = greater_than_or_equals
				}
			}
			country_event = {
				days = 1
				id = barrad_friends.997
			}
		}
	}
}

BAR_relations_idea_swap = {
	hidden_effect = {
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_silver_positive
					}
				}
				add_ideas = BAR_relations_asinti_silver_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_silver_negative
					}
				}
				add_ideas = BAR_relations_asinti_silver_negative
			}
		}
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_leopold_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_leopold_positive
					}
				}
				add_ideas = BAR_relations_asinti_leopold_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_leopold_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_leopold_negative
					}
				}
				add_ideas = BAR_relations_asinti_leopold_negative
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_viira_positive
					}
				}
				add_ideas = BAR_relations_asinti_viira_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_asinti_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_asinti_viira_negative
					}
				}
				add_ideas = BAR_relations_asinti_viira_negative
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_leopold_alive
				has_country_flag = barrad_silver_star_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_silver_leopold_positive
					}
				}
				add_ideas = BAR_relations_silver_leopold_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_leopold_alive
				has_country_flag = barrad_silver_star_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_silver_leopold_negative
					}
				}
				add_ideas = BAR_relations_silver_leopold_negative
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_viira
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_silver_star_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_silver_viira_positive
					}
				}
				add_ideas = BAR_relations_silver_viira_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_viira
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_silver_star_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_silver_viira_negative
					}
				}
				add_ideas = BAR_relations_silver_viira_negative
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 70
					compare = greater_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_leopold_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_leopold_viira_positive
					}
				}
				add_ideas = BAR_relations_leopold_viira_positive
			}
		}
		if = {
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 30
					compare = less_than_or_equals
				}
				has_country_flag = barrad_viira_alive
				has_country_flag = barrad_leopold_alive
			}
			if = {
				limit = {
					NOT = {
						has_idea = BAR_relations_leopold_viira_negative
					}
				}
				add_ideas = BAR_relations_leopold_viira_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 70
					compare = less_than
				}
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_silver_positive
				}
				remove_ideas = BAR_relations_asinti_silver_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_silver_negative
				}
				remove_ideas = BAR_relations_asinti_silver_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 70
					compare = less_than
				}
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_leopold_positive
				}
				remove_ideas = BAR_relations_asinti_leopold_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_leopold_negative
				}
				remove_ideas = BAR_relations_asinti_leopold_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 70
					compare = less_than
				}
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_viira_positive
				}
				remove_ideas = BAR_relations_asinti_viira_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_asinti_viira_negative
				}
				remove_ideas = BAR_relations_asinti_viira_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 70
					compare = less_than
				}
				has_country_flag = barrad_silver_star_alive
			}
			if = {
				limit = {
					has_idea = BAR_relations_silver_leopold_positive
				}
				remove_ideas = BAR_relations_silver_leopold_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_silver_leopold_negative
				}
				remove_ideas = BAR_relations_silver_leopold_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_silver_viira
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_silver_viira
					value = 70
					compare = less_than
				}
			}
			if = {
				limit = {
					has_idea = BAR_relations_silver_viira_positive
				}
				remove_ideas = BAR_relations_silver_viira_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_silver_viira_negative
				}
				remove_ideas = BAR_relations_silver_viira_negative
			}
		}
		if = {
			#remove both
			limit = {
				tag = BAR
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 30
					compare = greater_than
				}
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 70
					compare = less_than
				}
			}
			if = {
				limit = {
					has_idea = BAR_relations_leopold_viira_positive
				}
				remove_ideas = BAR_relations_leopold_viira_positive
			}
			if = {
				limit = {
					has_idea = BAR_relations_leopold_viira_negative
				}
				remove_ideas = BAR_relations_leopold_viira_negative
			}
		}
		BAR_happy_ending = yes
	}
}


 ######                                                          
 #     # ######  ####   ####  #    # #####   ####  ######  ####  
 #     # #      #      #    # #    # #    # #    # #      #      
 ######  #####   ####  #    # #    # #    # #      #####   ####  
 #   #   #           # #    # #    # #####  #      #           # 
 #    #  #      #    # #    # #    # #   #  #    # #      #    # 
 #     # ######  ####   ####   ####  #    #  ####  ######  ####  
                                                                 


#
# @param BAR_resource_to_modify_ammount the amount that will be added/subtracted from the resources after executing functions
# ALL actions on the resources MUST be done thought this methods due to bar_count_resources() neeeding to be called afterwards
#

bar_silver_resources_add = {
	add_to_variable = {
		var = BAR_resources_silver
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_leopold_resources_add = {
	add_to_variable = {
		var = BAR_resources_leopold
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_asinti_resources_add = {
	add_to_variable = {
		var = BAR_resources_asinti
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_viira_resources_add = {
	add_to_variable = {
		var = BAR_resources_viira
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}



bar_silver_resources_subtract = {
	subtract_from_variable = {
		var = BAR_resources_silver
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_leopold_resources_subtract = {
	subtract_from_variable = {
		var = BAR_resources_leopold
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_asinti_resources_subtract = {
	subtract_from_variable = {
		var = BAR_resources_asinti
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}

bar_viira_resources_subtract = {
	subtract_from_variable = {
		var = BAR_resources_viira
		value = BAR_resource_to_modify_ammount
	}
	bar_count_resources = yes
}


#
# wrappers for the resource modification, to not forget about @BAR_resource_to_modify_ammount and tooltip
#
bar_silver_resources_add_250 = {
	custom_effect_tooltip = bar_silver_resources_add_250_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_silver_resources_add = yes
}
bar_silver_resources_add_500 = {
	custom_effect_tooltip = bar_silver_resources_add_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_silver_resources_add = yes
}
bar_silver_resources_add_750 = {
	custom_effect_tooltip = bar_silver_resources_add_750_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_silver_resources_add = yes
}
bar_silver_resources_add_1000 = {
	custom_effect_tooltip = bar_silver_resources_add_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_silver_resources_add = yes
}


bar_leopold_resources_add_250 = {
	custom_effect_tooltip = bar_leopold_resources_add_250_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_leopold_resources_add = yes
}
bar_leopold_resources_add_500 = {
	custom_effect_tooltip = bar_leopold_resources_add_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 500
	}
	bar_leopold_resources_add = yes
}
bar_leopold_resources_add_750 = {
	custom_effect_tooltip = bar_leopold_resources_add_750_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 750
	}
	bar_leopold_resources_add = yes
}
bar_leopold_resources_add_1000 = {
	custom_effect_tooltip = bar_leopold_resources_add_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_leopold_resources_add = yes
}


bar_asinti_resources_add_250 = {
	custom_effect_tooltip = bar_asinti_resources_add_250_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_asinti_resources_add = yes
}
bar_asinti_resources_add_500 = {
	custom_effect_tooltip = bar_asinti_resources_add_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 500
	}
	bar_asinti_resources_add = yes
}
bar_asinti_resources_add_750 = {
	custom_effect_tooltip = bar_asinti_resources_add_750_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 750
	}
	bar_asinti_resources_add = yes
}
bar_asinti_resources_add_1000 = {
	custom_effect_tooltip = bar_asinti_resources_add_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_asinti_resources_add = yes
}

bar_viira_resources_add_250 = {
	custom_effect_tooltip = bar_viira_resources_add_250_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 250
	}
	bar_viira_resources_add = yes
}
bar_viira_resources_add_500 = {
	custom_effect_tooltip = bar_viira_resources_add_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 500
	}
	bar_viira_resources_add = yes
}
bar_viira_resources_add_750 = {
	custom_effect_tooltip = bar_viira_resources_add_750_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 750
	}
	bar_viira_resources_add = yes
}
bar_viira_resources_add_1000 = {
	custom_effect_tooltip = bar_viira_resources_add_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_viira_resources_add = yes
}


bar_silver_resources_subtract_500 = {
	custom_effect_tooltip = bar_silver_resources_subtract_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 500
	}
	bar_silver_resources_subtract = yes
}
bar_silver_resources_subtract_1000 = {
	custom_effect_tooltip = bar_silver_resources_subtract_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_silver_resources_subtract = yes
}
bar_silver_resources_subtract_1500 = {
	custom_effect_tooltip = bar_silver_resources_subtract_1500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1500
	}
	bar_silver_resources_subtract = yes
}

bar_leopold_resources_subtract_500 = {
	custom_effect_tooltip = bar_leopold_resources_subtract_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 750
	}
	bar_leopold_resources_subtract = yes
}
bar_leopold_resources_subtract_1000 = {
	custom_effect_tooltip = bar_leopold_resources_subtract_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_leopold_resources_subtract = yes
}
bar_leopold_resources_subtract_1500 = {
	custom_effect_tooltip = bar_leopold_resources_subtract_1500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1500
	}
	bar_leopold_resources_subtract = yes
}

bar_asinti_resources_subtract_500 = {
	custom_effect_tooltip = bar_asinti_resources_subtract_500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 500
	}
	bar_asinti_resources_subtract = yes
}
bar_asinti_resources_subtract_1500 = {
	custom_effect_tooltip = bar_asinti_resources_subtract_1500_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1500
	}
	bar_asinti_resources_subtract = yes
}

bar_viira_resources_subtract_750 = {
	custom_effect_tooltip = bar_viira_resources_subtract_750_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 750
	}
	bar_viira_resources_subtract = yes
}
bar_viira_resources_subtract_1000 = {
	custom_effect_tooltip = bar_viira_resources_subtract_1000_tooltip
	set_variable = {
		BAR_resource_to_modify_ammount = 1000
	}
	bar_viira_resources_subtract = yes
}

 ######                                                    
 #     # ###### #        ##   ##### #  ####  #    #  ####  
 #     # #      #       #  #    #   # #    # ##   # #      
 ######  #####  #      #    #   #   # #    # # #  #  ####  
 #   #   #      #      ######   #   # #    # #  # #      # 
 #    #  #      #      #    #   #   # #    # #   ## #    # 
 #     # ###### ###### #    #   #   #  ####  #    #  ####  
                                                           
 #
 # all relation changes MUST be made using those in order to prevent bugs in friendship path
 # @BAR_begun_friendship_path flag disables raising/lowering relations
 #

BAR_relations_increase_asinti_silver_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_asinti_silver
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_asinti_silver
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_silver = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_increase_asinti_leopold_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_asinti_leopold
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_asinti_leopold
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_leopold = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_increase_asinti_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_asinti_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_asinti_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_viira = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_increase_silver_leopold_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_silver_leopold
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_silver_leopold
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_silver_leopold = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_increase_silver_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_silver_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_viira
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_silver_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_silver_viira = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_increase_leopold_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_increase_leopold_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 95
					compare = less_than_or_equals
				}
			}
			add_to_variable = {
				var = BAR_relations_leopold_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_leopold_viira = 100
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_asinti_silver_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_asinti_silver
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_asinti_silver
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_silver = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_asinti_leopold_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_asinti_leopold
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_leopold
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_asinti_leopold
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_leopold = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_asinti_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_asinti_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_viira
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_asinti_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_asinti_viira = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_silver_leopold_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_silver_leopold
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_silver_leopold
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_silver_leopold = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_silver_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_silver_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_viira
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_silver_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_silver_viira = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_leopold_viira_5 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		custom_effect_tooltip = BAR_relations_decrease_leopold_viira
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_leopold_viira
					value = 5
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_leopold_viira
				value = 5
			}
		}
		else = {
			set_variable = {
				BAR_relations_leopold_viira = 0
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_relations_decrease_all_1 = {
	if = {
		limit = {
			NOT = {
				has_country_flag = BAR_begun_friendship_path
			}
		}
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_asinti_silver
					value = 1
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_asinti_silver
				value = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_leopold
					value = 1
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_silver_leopold
				value = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					var = BAR_relations_silver_viira
					value = 1
					compare = greater_than_or_equals
				}
			}
			subtract_from_variable = {
				var = BAR_relations_silver_viira
				value = 1
			}
		}
		BAR_relations_idea_swap = yes
	}
}

BAR_remove_cooperation = {
	remove_ideas = BAR_relations_asinti_silver_positive
	remove_ideas = BAR_relations_asinti_leopold_positive
	remove_ideas = BAR_relations_asinti_viira_positive
	remove_ideas = BAR_relations_silver_leopold_positive
	remove_ideas = BAR_relations_silver_viira_positive
	remove_ideas = BAR_relations_leopold_viira_positive
	remove_ideas = BAR_relations_asinti_silver_negative
	remove_ideas = BAR_relations_asinti_leopold_negative
	remove_ideas = BAR_relations_asinti_viira_negative
	remove_ideas = BAR_relations_silver_leopold_negative
	remove_ideas = BAR_relations_silver_viira_negative
	remove_ideas = BAR_relations_leopold_viira_negative
}
                                                                                                                
 #    # # #      #      # #    #  ####      ####  #    #   ##   #####    ##    ####  ##### ###### #####   ####  
 #   #  # #      #      # ##   # #    #    #    # #    #  #  #  #    #  #  #  #    #   #   #      #    # #      
 ####   # #      #      # # #  # #         #      ###### #    # #    # #    # #        #   #####  #    #  ####  
 #  #   # #      #      # #  # # #  ###    #      #    # ###### #####  ###### #        #   #      #####       # 
 #   #  # #      #      # #   ## #    #    #    # #    # #    # #   #  #    # #    #   #   #      #   #  #    # 
 #    # # ###### ###### # #    #  ####      ####  #    # #    # #    # #    #  ####    #   ###### #    #  ####  
                                                                                                                


barrad_kill_leopold = {
	hidden_effect = {
		clr_country_flag = barrad_leopold_alive
		if = {
			limit = {
				has_variable = bar_pen_screen_show
			}
			bar_gui_update = yes
		}
		if = {
			limit = {
				has_character = BAR_leopold_schmeller
			}
			BAR_leopold_schmeller = {
				retire = yes
			}
		}
		set_technology = {
			popup = no
			barrad_leopold_alive = 0
		}
		clear_variable = BAR_resources_leopold
		if = {
			limit = {
				624 = {
					is_owned_by = BAR
				}
			}
			set_province_name = {
				id = 4557
				name = BAR_beorgham
			}
		}
		remove_ideas = BAR_relations_asinti_leopold_negative
		remove_ideas = BAR_relations_asinti_leopold_positive
		remove_ideas = BAR_relations_leopold_viira_negative
		remove_ideas = BAR_relations_leopold_viira_positive
		remove_ideas = BAR_relations_silver_leopold_negative
		remove_ideas = BAR_relations_silver_leopold_positive
		add_popularity = {
			ideology = fascism
			popularity = -0.1
		}
		set_variable = {
			bar_expedition_members^2 = 1
		}
	}
}

barrad_kill_asinti = {
	hidden_effect = {
		clr_country_flag = barrad_asinti_alive
		if = {
			limit = {
				has_variable = bar_pen_screen_show
			}
			bar_gui_update = yes
		}
		if = {
			limit = {
				has_character = BAR_asinti
			}
			BAR_asinti = {
				retire = yes
			}
		}
		set_technology = {
			popup = no
			barrad_asinti_alive = 0
		}
		clear_variable = BAR_resources_asinti
		if = {
			limit = {
				625 = {
					is_owned_by = BAR
				}
			}
			set_province_name = {
				id = 4516
				name = BAR_grenbridge
			}
		}
		remove_ideas = BAR_relations_asinti_leopold_negative
		remove_ideas = BAR_relations_asinti_leopold_positive
		remove_ideas = BAR_relations_asinti_viira_negative
		remove_ideas = BAR_relations_asinti_viira_positive
		remove_ideas = BAR_relations_asinti_silver_negative
		remove_ideas = BAR_relations_asinti_silver_positive
		add_popularity = {
			ideology = fascism
			popularity = -0.1
		}
		set_variable = {
			bar_expedition_members^3 = 1
		}
	}
}

barrad_kill_silver = {
	hidden_effect = {
		clr_country_flag = barrad_silver_star_alive
		if = {
			limit = {
				has_variable = bar_pen_screen_show
			}
			bar_gui_update = yes
		}
		if = {
			limit = {
				has_character = BAR_silver_star
			}
			BAR_silver_star = {
				retire = yes
			}
		}
		set_technology = {
			popup = no
			barrad_silver_star_alive = 0
		}
		clear_variable = BAR_resources_silver
		remove_ideas = BAR_relations_silver_leopold_negative
		remove_ideas = BAR_relations_silver_leopold_positive
		remove_ideas = BAR_relations_silver_viira_negative
		remove_ideas = BAR_relations_silver_viira_positive
		remove_ideas = BAR_relations_asinti_silver_negative
		remove_ideas = BAR_relations_asinti_silver_positive
		add_popularity = {
			ideology = fascism
			popularity = -0.1
		}
		set_variable = {
			bar_expedition_members^1 = 1
		}
	}
}

barrad_kill_viira = {
	hidden_effect = {
		clr_country_flag = barrad_viira_alive
		if = {
			limit = {
				has_variable = bar_pen_screen_show
			}
			bar_gui_update = yes
		}
		if = {
			limit = {
				has_character = BAR_viira_lehtola
			}
			BAR_viira_lehtola = {
				retire = yes
			}
		}
		set_technology = {
			popup = no
			barrad_viira_alive = 0
		}
		clear_variable = BAR_resources_viira
		if = {
			limit = {
				625 = {
					is_owned_by = BAR
				}
			}
			set_province_name = {
				id = 4910
				name = BAR_axford
			}
		}
		remove_ideas = BAR_relations_leopold_viira_negative
		remove_ideas = BAR_relations_leopold_viira_positive
		remove_ideas = BAR_relations_silver_viira_negative
		remove_ideas = BAR_relations_silver_viira_positive
		remove_ideas = BAR_relations_asinti_viira_negative
		remove_ideas = BAR_relations_asinti_viira_positive
		add_popularity = {
			ideology = fascism
			popularity = -0.1
		}
		set_variable = {
			bar_expedition_members^4 = 1
		}
	}
}

bar_kill_ambrosius = {
	if = {
		limit = {
			has_variable = bar_pen_screen_show
		}
		bar_gui_update = yes
	}
	if = {
		limit = {
			has_character = BAR_count_ambrosius
		}
		BAR_count_ambrosius = {
			retire = yes
		}
	}
	set_country_flag = BAR_ambrosius_killed
}

change_all_province_names = {
	hidden_effect = {
		set_province_name = {
			id = 4516
			name = BAR_grenbridge
		}
		set_province_name = {
			id = 4910
			name = BAR_axford
		}
		set_province_name = {
			id = 4557
			name = BAR_beorgham
		}
		set_province_name = {
			id = 12307
			name = BAR_elysium
		}
	}
}


  #####                                    #####                      
 #     # # #      #    # ###### #####     #     # #####   ##   #####  
 #       # #      #    # #      #    #    #         #    #  #  #    # 
  #####  # #      #    # #####  #    #     #####    #   #    # #    # 
       # # #      #    # #      #####           #   #   ###### #####  
 #     # # #       #  #  #      #   #     #     #   #   #    # #   #  
  #####  # ######   ##   ###### #    #     #####    #   #    # #    # 
                                                                      


BAR_population_convert = {
	THIS = {
		set_state_category = rural
		#half od the factories are added to barrad capital
		set_temp_variable = {
			armsFactories = arms_factory_level
		}
		set_temp_variable = {
			civFactories = industrial_complex_level
		}
		divide_temp_variable = {
			armsFactories = 2
		}
		divide_temp_variable = {
			civFactories = 2
		}
		round_variable = armsFactories
		round_variable = civFactories
		626 = {
			if = {
				limit = {
					check_variable = {
						armsFactories > 0
					}
				}
				add_extra_state_shared_building_slots = armsFactories
				add_building_construction = {
					type = arms_factory
					level = armsFactories
					instant_build = yes
				}
			}
			if = {
				limit = {
					check_variable = {
						civFactories > 0
					}
				}
				add_extra_state_shared_building_slots = industrial_complex_level
				add_building_construction = {
					type = industrial_complex
					level = civFactories
					instant_build = yes
				}
			}
		}
		set_building_level = {
			type = arms_factory
			level = 0
			instant_build = yes
		}
		set_building_level = {
			type = industrial_complex
			level = 0
			instant_build = yes
		}
	}
	add_compliance = 100
	hidden_effect = {
		set_temp_variable = {
			popToAdd = state_population
		}
		multiply_temp_variable = {
			popToAdd = 0.4
		}
		save_current_manpower = yes
		while_loop_effect = {
			limit = {
				THIS = {
					state_population > 900000
				}
			}
			THiS = {
				add_manpower = -900000
			}
		}
		THiS = {
			set_temp_variable = {
				popToKill = state_population
			}
			multiply_temp_variable = {
				popToKill = -1
			}
			add_manpower = -popToKill
		}
		restore_previous_manpower = yes
		ROOT = {
			add_manpower = popToAdd
		}
	}
	custom_effect_tooltip = bar_convert_population_manpower_tooltip
}

BAR_un_idea_buffs_remove = {
	hidden_effect = {
		clr_country_flag = BAR_un_buff_piercing_flag
		clr_country_flag = BAR_un_buff_org_flag
		clr_country_flag = BAR_un_buff_break_flag
		clr_country_flag = BAR_un_buff_def_flag
		clr_country_flag = BAR_un_buff_attack_flag
		set_technology = {
			popup = no
			BAR_un_buff_piercing_tech = 0
		}
		set_technology = {
			popup = no
			BAR_un_buff_org_tech = 0
		}
		set_technology = {
			popup = no
			BAR_un_buff_break_tech = 0
		}
		set_technology = {
			popup = no
			BAR_un_buff_def_tech = 0
		}
		set_technology = {
			popup = no
			BAR_un_buff_attack_tech = 0
		}
	}
}

bar_kill_advisors = {
	if = {
		limit = {
			has_variable = bar_pen_screen_show
		}
		bar_gui_update = yes
	}
	set_country_flag = BAR_advisors_killed
	BAR_leofric_and_godgifu_glaedwine = {
		set_character_name = BAR_ded_scientist
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_aethelflaed_sigeweard = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_hereweald_ealdwine = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_eadmund_heahstan = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_sabedoria = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_oswine_sigespere = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_mister_lilly = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor2
			}
		}
	}
	BAR_leofric_stearcstan = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_beorhtsige_sigespere = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_ceadda_sigeweald = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_godric_hereweald = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_wigmund_sunnespere = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_stithulf_frostdun = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_hrothgar_fiscford = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_wilfrith_faegerwell = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
	BAR_cyneweard_stangaet = {
		set_portraits = {
			army = {
				small = GFX_idea_BAR_undead_advisor
			}
		}
	}
}


 #     #                   
 #     # # # #####    ##   
 #     # # # #    #  #  #  
 #     # # # #    # #    # 
  #   #  # # #####  ###### 
   # #   # # #   #  #    # 
    #    # # #    # #    # 
                           


bar_viira_spells_max_overload = {
	hidden_effect = {
		set_variable = {
			viira_max_overload = 0
		}
		every_owned_state = {
			limit = {
				check_variable = { building_level@nuclear_reactor > 0 }		
			}
			BAR = {
				add_to_variable = {
					viira_max_overload = 100
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					viira_mana_overload > viira_max_overload
				}
			}
			country_event = {
				id = barrad_viira.997
			}
		}
		bar_viira_spells_overload_calculate_percentage = yes
	}
}

bar_viira_spells_overload_calculate_percentage = {
	if = {
		limit = {
			check_variable = {
				viira_mana_overload = 0
			}
		}
		set_variable = {
			viira_mana_overload_percentage = 0
		}
	} else_if ={
		limit = {
			check_variable = {
				viira_max_overload = 0
			}
		}
		set_variable = {
			viira_mana_overload_percentage = 100
		}
	} else = {
		set_variable = {
			viira_mana_overload_percentage = viira_mana_overload
		}
		divide_variable = {
			viira_mana_overload_percentage = viira_max_overload
		}
		multiply_variable = {
			viira_mana_overload_percentage = 100
		}
		round_variable = viira_mana_overload_percentage
	}
}

bar_viira_spells_overload_monthly_tickdown = {
	set_temp_variable = {
		viira_mana_tickdown = 0
	}
	every_owned_state = {
		limit = {
			check_variable = { building_level@nuclear_reactor > 0 }		
		}
		BAR = {
			add_to_temp_variable = {
				viira_mana_tickdown = 9
			}
		}
	}
	subtract_from_variable = {
		viira_mana_overload = viira_mana_tickdown
	}
	if = {
		limit = {
			check_variable = {
				viira_mana_overload < 0
			}
		}
		set_variable = {
			viira_mana_overload = 0
		}
	}
	bar_viira_spells_overload_calculate_percentage = yes
}

BAR_new_viira_note = {
	hidden_effect = {
		ROOT = {
			set_variable = {
				BAR_new_journal_entry_trigger = 1
			}
			country_event = {
				id = bar_clear_journal.1
				hours = 6
			}
		}
	}
}
BAR_merge_commandments = {
	hidden_effect = {
		if = {
			limit = {
				has_idea = BAR_commandments_sacrifice_for_the_cause_idea
				has_idea = BAR_commandments_faith_primacy_idea
				has_idea = BAR_commandments_ritual_enlightment_idea
				has_idea = BAR_commandments_asceticism_idea
				has_idea = BAR_commandments_piety_of_work_idea
				has_idea = BAR_commandments_redempt_sins_idea
				has_idea = BAR_commandments_servitude_or_death_idea
				has_idea = BAR_commandments_sacred_insanity_idea
				has_idea = BAR_commandments_cult_of_progress_idea
				has_idea = BAR_commandments_holy_commune_idea
			}
			remove_ideas = BAR_commandments_sacrifice_for_the_cause_idea
			remove_ideas = BAR_commandments_faith_primacy_idea
			remove_ideas = BAR_commandments_ritual_enlightment_idea
			remove_ideas = BAR_commandments_asceticism_idea
			remove_ideas = BAR_commandments_piety_of_work_idea
			remove_ideas = BAR_commandments_redempt_sins_idea
			remove_ideas = BAR_commandments_servitude_or_death_idea
			remove_ideas = BAR_commandments_sacred_insanity_idea
			remove_ideas = BAR_commandments_cult_of_progress_idea
			remove_ideas = BAR_commandments_holy_commune_idea
			add_ideas = BAR_commandments_combined
		}
	}
}

BAR_unlock_spells_1 = {
	#mass migration
	set_country_flag = BAR_spells_unlocked_1
	set_country_flag = bar_viira_investigation_step_14
}

BAR_unlock_spells_2 = {
	#research bonuses
	set_country_flag = BAR_spells_unlocked_2
	set_country_flag = bar_viira_investigation_step_15
}

BAR_unlock_spells_3 = {
	#stronger spells
	set_country_flag = BAR_spells_unlocked_3
	set_country_flag = bar_viira_investigation_step_16
}

BAR_unlock_spells_4 = {
	#psi powers upgrade
	every_owned_state = {
		if = {
			limit = {
				has_state_flag = BAR_climate
			}
			remove_province_modifier = {
				static_modifiers = {
					barrad_climate3
				}
				province = {
					all_provinces = yes
				}
			}
			add_province_modifier = {
				static_modifiers = {
					barrad_climate4
				}
				province = {
					all_provinces = yes
				}
			}
		}
	}
	set_country_flag = BAR_spells_unlocked_4
	set_country_flag = bar_viira_investigation_step_17
}

BAR_unlock_spells_5 = {
	#conjure buildings
	set_country_flag = BAR_spells_unlocked_5
	set_country_flag = bar_viira_investigation_step_18
}

BAR_unlock_spells_6 = {
	#mind control perfection
	set_country_flag = BAR_spells_unlocked_6
	set_country_flag = bar_viira_investigation_step_19
}

BAR_unlock_spells_7 = {
	#conjure resources
	modify_building_resources = {
		building = nuclear_reactor
		resource = aluminium 
		amount = 2
	}modify_building_resources = {
		building = nuclear_reactor
		resource = aluminium 
		amount = 2
	}
	modify_building_resources = {
		building = nuclear_reactor
		resource = chromium
		amount = 2
	}
	modify_building_resources = {
		building = nuclear_reactor
		resource = tungsten
		amount = 2
	}
	modify_building_resources = {
		building = nuclear_reactor
		resource = rubber
		amount = 2
	}
	modify_building_resources = {
		building = nuclear_reactor
		resource = oil
		amount = 2
	}
	modify_building_resources = {
		building = nuclear_reactor
		resource = crystals
		amount = 2
	}
	set_country_flag = BAR_spells_unlocked_7
	set_country_flag = bar_viira_investigation_step_20
}

BAR_unlock_spells_8 = {
	#ascend
	country_event = {
		id = barrad_viira.16
	}
	set_country_flag = BAR_spells_unlocked_8
	set_country_flag = bar_viira_investigation_step_21
}
BAR_spell_upgrades_prepare = {
	resize_array = {
		array = bar_viira_mana_crystal_array
		value = 1
		size = 16
	}
	for_each_loop = {
		array = bar_viira_mana_crystal_array
		index = crystal_index
		if = {
			limit = {
				nuclear_reactor > crystal_index
			}
			set_variable = {
				bar_viira_mana_crystal_array^crystal_index = 2
			}
		}
		else = {
			set_variable = {
				bar_viira_mana_crystal_array^crystal_index = 1
			}
		}
	}
}

  #####                                            
 #     # #      ######   ##   #    # #    # #####  
 #       #      #       #  #  ##   # #    # #    # 
 #       #      #####  #    # # #  # #    # #    # 
 #       #      #      ###### #  # # #    # #####  
 #     # #      #      #    # #   ## #    # #      
  #####  ###### ###### #    # #    #  ####  #      
                                                   


BAR_clear_mess_puppet = {
	hidden_effect = {
		set_country_flag = BAR_end_of_pentarchy
		clr_country_flag = BAR_undead_convert
		clr_country_flag = barrad_early_game
		clr_country_flag = BAR_asinti_kill_count
		clear_variable = BAR_viira_godhood
		remove_ideas = BAR_blood_curse_idea
		remove_ideas = BAR_pentarchy
		remove_ideas = BAR_pentarchy_enemy
		remove_ideas = BAR_pentarchy_concern
		if = {
			limit = {
				has_template = "Leopold Schmeller"
			}
			delete_unit_template_and_units = {
				division_template = "Leopold Schmeller"
				disband = no
			}
			add_equipment_to_stockpile = {
				type = bar_leopold_equipment_1
				amount = -1000
			}
		}
		set_technology = {
			bar_leopold_new_body = 0
		}
		set_technology = {
			BAR_clockwerks = 0
		}
		set_technology = {
			BAR_clockwerks_upgrade = 0
		}
		add_country_leader_role = {
			character = BAR_angry_mob
			promote_leader = yes
			country_leader = {
				expire = "1965.1.1"
				ideology = falangism
			}
		}
		every_character = {
			remove_unit_leader_role = yes
		}
		load_focus_tree = generic_griffon_focus
		add_ideas = poverty1
		add_ideas = lack_of_scientists2
		add_ideas = limited_conscription
		add_ideas = civilian_economy
		change_all_province_names = yes
		drop_cosmetic_tag = yes
	}
}


  #####           
 #     # #    # # 
 #       #    # # 
 #  #### #    # # 
 #     # #    # # 
 #     # #    # # 
  #####   ####  # 
                  


BAR_gui_reset = {
	if = {
		limit = {
			has_country_flag = barrad_leopold_alive
		}
		set_variable = {
			bar_leopold_state = 2
		}
	}
	else = {
		set_variable = {
			bar_leopold_state = 4
		}
	}
	if = {
		limit = {
			OR = {
				has_country_flag = BAR_advisors_killed
				has_country_flag = BAR_ambrosius_killed
			}
		}
		set_variable = {
			bar_ambrosius_state = 4
		}
	}
	else = {
		set_variable = {
			bar_ambrosius_state = 2
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_silver_star_alive
		}
		set_variable = {
			bar_silver_state = 2
		}
	}
	else = {
		set_variable = {
			bar_silver_state = 4
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_asinti_alive
		}
		set_variable = {
			bar_asinti_state = 2
		}
	}
	else = {
		set_variable = {
			bar_asinti_state = 4
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_viira_alive
		}
		set_variable = {
			bar_viira_state = 2
		}
	}
	else = {
		set_variable = {
			bar_viira_state = 4
		}
	}
}

bar_gui_update = {
	add_to_variable = {
		bar_pen_screen_show = 1
	}
	if = {
		limit = {
			OR = {
				has_country_flag = BAR_advisors_killed
				has_country_flag = BAR_ambrosius_killed
			}
			check_variable = {
				bar_ambrosius_state < 3
			}
		}
		add_to_variable = {
			bar_ambrosius_state = 2
		}
	}
	if = {
		limit = {
			NOT = {
				has_country_flag = barrad_leopold_alive
			}
			check_variable = {
				bar_leopold_state < 3
			}
		}
		add_to_variable = {
			bar_leopold_state = 2
		}
	}
	if = {
		limit = {
			NOT = {
				has_country_flag = barrad_silver_star_alive
			}
			check_variable = {
				bar_silver_state < 3
			}
		}
		add_to_variable = {
			bar_silver_state = 2
		}
	}
	if = {
		limit = {
			NOT = {
				has_country_flag = barrad_asinti_alive
			}
			check_variable = {
				bar_asinti_state < 3
			}
		}
		add_to_variable = {
			bar_asinti_state = 2
		}
	}
	if = {
		limit = {
			NOT = {
				has_country_flag = barrad_viira_alive
			}
			check_variable = {
				bar_viira_state < 3
			}
		}
		add_to_variable = {
			bar_viira_state = 2
		}
	}
}

                                                                                                                                        
  ####  #    #   ##   #####    ##    ####  ##### ###### #####     #####  ######  ####  #####  #    # # ##### #    # ###### #    # ##### 
 #    # #    #  #  #  #    #  #  #  #    #   #   #      #    #    #    # #      #    # #    # #    # #   #   ##  ## #      ##   #   #   
 #      ###### #    # #    # #    # #        #   #####  #    #    #    # #####  #      #    # #    # #   #   # ## # #####  # #  #   #   
 #      #    # ###### #####  ###### #        #   #      #####     #####  #      #      #####  #    # #   #   #    # #      #  # #   #   
 #    # #    # #    # #   #  #    # #    #   #   #      #   #     #   #  #      #    # #   #  #    # #   #   #    # #      #   ##   #   
  ####  #    # #    # #    # #    #  ####    #   ###### #    #    #    # ######  ####  #    #  ####  #   #   #    # ###### #    #   #   
                                                                                                                                        
BAR_hide_gasienica = {
	set_country_flag = BAR_gasienica_hidden
	remove_advisor_role = {
		character = BAR_captain_gasienica
		slot = political_advisor
	}
}

BAR_add_janosik_as_commander = {
	BAR_jerzy_janosik = {
		add_corps_commander_role = {
			traits = {
				griffon_race_trait
				trait_mountaineer
				hill_fighter
			}
			skill = 5
			attack_skill = 4
			defense_skill = 5
			planning_skill = 3
			logistics_skill = 4
		}
	}
	custom_effect_tooltip = jerzy_janosik_stats_tp
}

BAR_add_wigberht_as_commander = {
	add_corps_commander_role = {
		character = BAR_wigberht
		traits = {
			pony_race_trait
			infantry_officer
			skilled_staffer
		}
		skill = 3
		attack_skill = 2
		defense_skill = 2
		planning_skill = 2
		logistics_skill = 4
		legacy_id = 997002
	}
	custom_effect_tooltip = bar_wigberht_general
	if = {
		limit = {
			NOT = {
				has_template = "Armed Brothers"
			}
		}
		division_template = {
			name = "Armed Brothers"
			regiments = {
				infantry = {
					x = 0
					y = 0
				}
				infantry = {
					x = 0
					y = 1
				}
				infantry = {
					x = 0
					y = 2
				}
				infantry = {
					x = 1
					y = 0
				}
				infantry = {
					x = 1
					y = 1
				}
				infantry = {
					x = 1
					y = 2
				}
			}
		}
	}
	random_owned_controlled_state = {
		create_unit = {
			division = "name = \"Will\" division_template = \"Armed Brothers\" start_experience_factor = 0.5 start_equipment_factor = 1"
			owner = ROOT
		}
	}
	random_owned_controlled_state = {
		create_unit = {
			division = "name = \"Wisdom\" division_template = \"Armed Brothers\" start_experience_factor = 0.5 start_equipment_factor = 1"
			owner = ROOT
		}
	}
	random_owned_controlled_state = {
		create_unit = {
			division = "name = \"Power\" division_template = \"Armed Brothers\" start_experience_factor = 0.5 start_equipment_factor = 1"
			owner = ROOT
		}
	}
	random_owned_controlled_state = {
		create_unit = {
			division = "name = \"Sacrifice\" division_template = \"Armed Brothers\" start_experience_factor = 0.5 start_equipment_factor = 1"
			owner = ROOT
		}
	}
	custom_effect_tooltip = BAR_outer_circle_tooltip
}

BAR_add_gebleod_as_commander = {
	add_corps_commander_role = {
		character = BAR_gebleod
		traits = {
			pony_race_trait
			infantry_officer
			commando
			trait_mountaineer
			hill_fighter
		}
		skill = 4
		attack_skill = 5
		defense_skill = 2
		planning_skill = 2
		logistics_skill = 3
		legacy_id = 997001
	}
	custom_effect_tooltip = bar_gebleod_general
	if = {
		limit = {
			NOT = {
				has_template = "The Guard"
			}
		}
		if = {
			limit = {
				has_tech = tech_mountaineers
			}
			division_template = {
				name = "The Guard"
				regiments = {
					mountaineers = {
						x = 0
						y = 0
					}
					mountaineers = {
						x = 0
						y = 1
					}
					mountaineers = {
						x = 0
						y = 2
					}
					mountaineers = {
						x = 0
						y = 3
					}
					mountaineers = {
						x = 1
						y = 0
					}
					mountaineers = {
						x = 1
						y = 1
					}
					mountaineers = {
						x = 1
						y = 2
					}
					artillery_brigade = {
						x = 2
						y = 0
					}
					artillery_brigade = {
						x = 2
						y = 1
					}
				}
			}
		}
		else = {
			division_template = {
				name = "The Guard"
				regiments = {
					infantry = {
						x = 0
						y = 0
					}
					infantry = {
						x = 0
						y = 1
					}
					infantry = {
						x = 0
						y = 2
					}
					infantry = {
						x = 0
						y = 3
					}
					infantry = {
						x = 1
						y = 0
					}
					infantry = {
						x = 1
						y = 1
					}
					infantry = {
						x = 1
						y = 2
					}
					artillery_brigade = {
						x = 2
						y = 0
					}
					artillery_brigade = {
						x = 2
						y = 1
					}
				}
			}
		}
	}
	random_owned_controlled_state = {
		create_unit = {
			division = "name = \"Last Guard\" division_template = \"The Guard\" start_experience_factor = 1 start_equipment_factor = 1"
			owner = ROOT
		}
	}
	custom_effect_tooltip = BAR_inner_circle_tooltip
}


 #######                                                            
 #       #    # #####  ###### #####  # ##### #  ####  #    #  ####  
 #        #  #  #    # #      #    # #   #   # #    # ##   # #      
 #####     ##   #    # #####  #    # #   #   # #    # # #  #  ####  
 #         ##   #####  #      #    # #   #   # #    # #  # #      # 
 #        #  #  #      #      #    # #   #   # #    # #   ## #    # 
 ####### #    # #      ###### #####  #   #   #  ####  #    #  ####  
                                                                    


bar_expedition_init = {
	resize_array = {
		array = bar_expedition_members
		value = 1
		size = 5
	}
	set_variable = {
		bar_expedition_peril = 100
	}
	set_variable = {
		bar_expedition_success_chance = 100
	}
	set_variable = {
		bar_expedition_success_chance_bonus = 0
	}
	set_variable = {
		bar_expedition_cohesion = 100
	}
	set_variable = {
		bar_expedition_additional_equipment = 100
	}
	set_variable = {
		bar_expedition_length = 1
	}
}

bar_lower_cohesion = {
	if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 100
			}
		}
		set_variable = {
			bar_expedition_cohesion = 98
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 98
			}
		}
		set_variable = {
			bar_expedition_cohesion = 80
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 80
			}
		}
		set_variable = {
			bar_expedition_cohesion = 60
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 60
			}
		}
		set_variable = {
			bar_expedition_cohesion = 35
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 35
			}
		}
		set_variable = {
			bar_expedition_cohesion = 15
		}
	}
}

bar_raise_cohesion = {
	if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 98
			}
		}
		set_variable = {
			bar_expedition_cohesion = 100
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 80
			}
		}
		set_variable = {
			bar_expedition_cohesion = 98
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 60
			}
		}
		set_variable = {
			bar_expedition_cohesion = 80
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 35
			}
		}
		set_variable = {
			bar_expedition_cohesion = 60
		}
	}
	else_if = {
		limit = {
			check_variable = {
				bar_expedition_cohesion = 15
			}
		}
		set_variable = {
			bar_expedition_cohesion = 35
		}
	}
}

bar_expedition_adding_members_effects = {
	bar_lower_cohesion = yes
	subtract_from_variable = {
		bar_expedition_peril = 15
	}
	subtract_from_variable = {
		bar_expedition_success_chance = 10
	}
}

bar_expedition_removing_members_effects = {
	bar_raise_cohesion = yes
	add_to_variable = {
		bar_expedition_peril = 15
	}
	add_to_variable = {
		bar_expedition_success_chance = 10
	}
}

bar_expedition_additional_equipment_increase = {
	if = {
		limit = {
			check_variable = {
				bar_expedition_additional_equipment < 1000
			}
		}
		add_to_variable = {
			bar_expedition_additional_equipment = 100
		}
		subtract_from_variable = {
			bar_expedition_peril = 10
		}
	}
	bar_recalculate_expedition = yes
}

bar_expedition_additional_equipment_decrease = {
	if = {
		limit = {
			check_variable = {
				bar_expedition_additional_equipment > 100
			}
		}
		subtract_from_variable = {
			bar_expedition_additional_equipment = 100
		}
		add_to_variable = {
			bar_expedition_peril = 10
		}
	}
	bar_recalculate_expedition = yes
}

bar_recalculate_expedition = {
	add_to_variable = {
		bar_expedition_show = 1
	}
}

bar_expedition_week_end = {
	add_to_variable = { bar_expedition_week = 1 }

	bar_expedition_success_phase = yes

	set_variable_to_random = {
		var = rolled_peril
		min = 0
		max = 100
		integer = yes
	}	
	set_variable_to_random = {
		var = rolled_cohesion
		min = 0
		max = 100
		integer = yes
	}

	if = { #peril phase
		limit = {
			check_variable = {
				var = bar_expedition_peril
				value = rolled_peril
				compare = greater_than_or_equals
			}
		}
		
		clear_array = bar_expedition_loot	
		country_event = { id = bar_expedition.2 }
	} else_if = { #cohesion phase
		limit = {
			check_variable = {
				var = rolled_cohesion
				value = bar_expedition_cohesion
				compare = greater_than_or_equals
			}
		}
		country_event = { id = bar_expedition.3 }
	} else_if = { #expedition end
		limit = {
			check_variable = {
				var = bar_expedition_week
				value = bar_expedition_length
				compare = greater_than_or_equals
			}
		}
		country_event = { id = bar_expedition.4 }
	} else = { #expedition continues
		activate_mission = BAR_expedition_progresses
	}
}

bar_expedition_success_phase = {
	for_each_loop = {
		array = bar_expedition_members
		index = character_index
		value = is_selected
		if = {
			limit = {
				check_variable = {
					is_selected = 2
				}
			}
			set_variable_to_random = {
				var = rolled_success_chance
				min = 0
				max = 100
				integer = yes
			}
			if = {
				limit = {
					check_variable = {
						value = rolled_success_chance
						var = bar_expedition_success_chance
						compare = greater_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {
							character_index = 0
						}
					}
					bar_expedition_roll_gasienica_loot = yes
				}
				else_if = {
					limit = {
						check_variable = {
							character_index = 1
						}
					}
					bar_expedition_roll_silver_loot = yes
				}
				else_if = {
					limit = {
						check_variable = {
							character_index = 2
						}
					}
					bar_expedition_roll_leopold_loot = yes
				}
				else_if = {
					limit = {
						check_variable = {
							character_index = 3
						}
					}
					bar_expedition_roll_asinti_loot = yes
				}
				else_if = {
					limit = {
						check_variable = {
							character_index = 4
						}
					}
					bar_expedition_roll_viira_loot = yes
				}
			}
		}
	}
}

bar_expedition_roll_gasienica_loot = {
	random_list = {
		5 = {
			add_to_array = {
				bar_expedition_loot = 17
			}
		}	
		10 = {
			add_to_array = {
				bar_expedition_loot = 18
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 19
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 20
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 21
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 22
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 23
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 24
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 25
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 26
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 27
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 28
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 29
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 30
			}
		}
		5 = {
			add_to_array = {
				bar_expedition_loot = 31
			}
		}
	}
}

bar_expedition_roll_silver_loot = {
	random_list = {
		40 = {
			add_to_array = {
				bar_expedition_loot = 1
			}
		}
		30 = {
			add_to_array = {
				bar_expedition_loot = 2
			}
		}
		20 = {
			add_to_array = {
				bar_expedition_loot = 3
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 4
			}
		}
	}
}

bar_expedition_roll_leopold_loot = {
	random_list = {
		40 = {
			add_to_array = {
				bar_expedition_loot = 5
			}
		}
		30 = {
			add_to_array = {
				bar_expedition_loot = 6
			}
		}
		20 = {
			add_to_array = {
				bar_expedition_loot = 7
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 8
			}
		}
	}
}

bar_expedition_roll_asinti_loot = {
	random_list = {
		40 = {
			add_to_array = {
				bar_expedition_loot = 9
			}
		}
		30 = {
			add_to_array = {
				bar_expedition_loot = 10
			}
		}
		20 = {
			add_to_array = {
				bar_expedition_loot = 11
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 12
			}
		}
	}
}

bar_expedition_roll_viira_loot = {
	random_list = {
		40 = {
			add_to_array = {
				bar_expedition_loot = 13
			}
		}
		30 = {
			add_to_array = {
				bar_expedition_loot = 14
			}
		}
		20 = {
			add_to_array = {
				bar_expedition_loot = 15
			}
		}
		10 = {
			add_to_array = {
				bar_expedition_loot = 16
			}
		}
	}
}

bar_expedition_retrive_loot = {
	for_each_loop = {
		array = bar_expedition_loot
		value = loot_id
		if = {
			limit = {
				check_variable = {
					loot_id = 1
				}
			}
			bar_silver_resources_add_250 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 2
				}
			}
			bar_silver_resources_add_500 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 3
				}
			}
			bar_silver_resources_add_750 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 4
				}
			}
			bar_silver_resources_add_1000 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 5
				}
			}
			bar_leopold_resources_add_250 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 6
				}
			}
			bar_leopold_resources_add_500 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 7
				}
			}
			bar_leopold_resources_add_750 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 8
				}
			}
			bar_leopold_resources_add_1000 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 9
				}
			}
			bar_asinti_resources_add_250 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 10
				}
			}
			bar_asinti_resources_add_500 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 11
				}
			}
			bar_asinti_resources_add_750 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 12
				}
			}
			bar_asinti_resources_add_1000 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 13
				}
			}
			bar_viira_resources_add_250 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 14
				}
			}
			bar_viira_resources_add_500 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 15
				}
			}
			bar_viira_resources_add_750 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 16
				}
			}
			bar_viira_resources_add_1000 = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 17
				}
			}
			add_political_power = 25
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 18
				}
			}
			add_political_power = 50
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 19
				}
			}
			add_political_power = 75
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 20
				}
			}
			add_political_power = 100
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 21
				}
			}
			if = {
				limit = {
					var:bar_expedition_target = {
						has_tech = basic_train
					}
				}
				add_equipment_to_stockpile = {
					type = train_equipment
					producer = var:bar_expedition_target
					amount = 2
				}
			} else = {
				add_equipment_to_stockpile = {
					type = infantry_equipment
					producer = var:bar_expedition_target
					amount = 500
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 22
				}
			}
			add_equipment_to_stockpile = {
				type = infantry_equipment
				producer = var:bar_expedition_target
				amount = 500
			}
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 23
				}
			}
			add_equipment_to_stockpile = {
				type = infantry_equipment
				producer = var:bar_expedition_target
				amount = 1000
			}
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 24
				}
			}
			if = {
				limit = {
					var:bar_expedition_target = {
						has_tech = tech_trucks
					}
				}
				add_equipment_to_stockpile = {
					type = motorized_equipment
					producer = var:bar_expedition_target
					amount = 50
				}
			} else = {
				add_equipment_to_stockpile = {
					type = infantry_equipment
					producer = var:bar_expedition_target
					amount = 500
				}
			}	
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 25
				}
			}
			one_random_industrial_complex = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 26
				}
			}
			one_random_arms_factory = yes
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 27
				}
			}
			add_manpower = 3000
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 28
				}
			}
			add_manpower = 6000
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 29
				}
			}
			add_equipment_to_stockpile = {
				type = artillery_equipment
				producer = var:bar_expedition_target
				amount = 50
			}
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 30
				}
			}
			add_equipment_to_stockpile = {
				type = support_equipment
				producer = var:bar_expedition_target
				amount = 100
			}
		}
		else_if = {
			limit = {
				check_variable = {
					loot_id = 31
				}
			}
			if = {
				limit = {
					has_dlc = "No Step Back"
				}
				steal_random_tech_bonus = {
					folder = nsb_armour_folder
					folder = artillery_folder
					folder = infantry_folder
					folder = support_folder
					bonus = 2
					dynamic = yes
					instant = yes
					target = var:bar_expedition_target
					uses = 1
				}
			}
			else = {
				steal_random_tech_bonus = {
					folder = armour_folder
					folder = artillery_folder
					folder = infantry_folder
					folder = support_folder
					bonus = 2
					dynamic = yes
					instant = yes
					target = var:bar_expedition_target
					uses = 1
				}
			}
		}
		clear_array = bar_expedition_loot
	}
}


                        
 #    # #  ####   ####  
 ##  ## # #      #    # 
 # ## # #  ####  #      
 #    # #      # #      
 #    # # #    # #    # 
 #    # #  ####   ####  
                        


one_state_inf = {
	if = {
		limit = {
			infrastructure < 10
		}
		add_building_construction = {
			type = infrastructure
			level = 1
			instant_build = yes
		}
	}
	else = {
		add_extra_state_shared_building_slots = 1
	}
}

bar_count_resources = {
	set_variable = {
		res_total = 0
	}
	if = {
		limit = {
			has_country_flag = barrad_asinti_alive
		}
		add_to_variable = {
			res_total = BAR_resources_asinti
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_leopold_alive
		}
		add_to_variable = {
			res_total = BAR_resources_leopold
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_silver_star_alive
		}
		add_to_variable = {
			res_total = BAR_resources_silver
		}
	}
}