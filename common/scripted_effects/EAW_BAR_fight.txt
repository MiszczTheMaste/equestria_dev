@PEN_FIGHT_VIIRA_MAX_HP = 280
@PEN_FIGHT_VIIRA_MAX_HP_INDEX = 28
@PEN_FIGHT_VIIRA_MAX_INITIATIVE = 20
@PEN_FIGHT_PENTARCHY_MAX_INITIATIVE = 10
@PEN_FIGHT_LEOPOLD_MAX_HP = 220
@PEN_FIGHT_LEOPOLD_MAX_HP_INDEX = 22
@PEN_FIGHT_ASINTI_MAX_HP = 190
@PEN_FIGHT_ASINTI_MAX_HP_INDEX = 19
@PEN_FIGHT_SILVER_STAR_MAX_HP = 170
@PEN_FIGHT_SILVER_STAR_MAX_HP_INDEX = 17

# pentarchy fight variables
bar_fight_initialisation_pentarchy_side = {
	set_country_flag = bar_fight_pentarchy_side
	bar_fight_initialisation = yes
	bar_pen_fight_gui_reload = yes
}

bar_fight_initialisation_viira_side = {
	set_country_flag = bar_fight_viira_side
	bar_fight_initialisation = yes
	bar_pen_fight_gui_reload = yes
}

bar_fight_initialisation = {
	set_variable = {
		bar_pentarchy_fight_show = 1
	}
	set_variable = {
		BAR_fight_pentarchy_action_log = 0
	}
	if = {
		limit = {
			has_country_flag = barrad_asinti_alive
		}
		set_variable = {
			a_hp = @PEN_FIGHT_ASINTI_MAX_HP
		}
		set_variable = {
			a_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
		set_variable = {
			bar_pen_fight_asinti_alive_at_start = 1
		}
		resize_array = {
			array = bar_fight_asinti_hp_bar
			value = 1
			size = @PEN_FIGHT_ASINTI_MAX_HP_INDEX
		}
		resize_array = {
			array = bar_fight_asinti_initiative_bar
			value = 1
			size = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_silver_star_alive
		}
		set_variable = {
			s_hp = @PEN_FIGHT_SILVER_STAR_MAX_HP
		}
		set_variable = {
			s_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
		set_variable = {
			bar_pen_fight_silver_alive_at_start = 1
		}
		resize_array = {
			array = bar_fight_silver_star_hp_bar
			value = 1
			size = @PEN_FIGHT_SILVER_STAR_MAX_HP_INDEX
		}
		resize_array = {
			array = bar_fight_silver_star_initiative_bar
			value = 1
			size = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_leopold_alive
		}
		set_variable = {
			l_hp = @PEN_FIGHT_LEOPOLD_MAX_HP
		}
		set_variable = {
			l_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
		set_variable = {
			bar_pen_fight_leopold_alive_at_start = 1
		}
		resize_array = {
			array = bar_fight_leopold_hp_bar
			value = 1
			size = @PEN_FIGHT_LEOPOLD_MAX_HP_INDEX
		}
		resize_array = {
			array = bar_fight_leopold_initiative_bar
			value = 1
			size = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
		}
	}
	set_variable = {
		v_hp = @PEN_FIGHT_VIIRA_MAX_HP
	}
	set_variable = {
		v_in = @PEN_FIGHT_VIIRA_MAX_INITIATIVE
	}
	set_variable = {
		v_stun = 0
	}
	set_variable = {
		viira_dmg_debuff = 1
	}
	resize_array = {
		array = bar_fight_viira_hp_bar
		value = 1
		size = @PEN_FIGHT_VIIRA_MAX_HP_INDEX
	}
	resize_array = {
		array = bar_fight_viira_initiative_bar
		value = 1
		size = @PEN_FIGHT_VIIRA_MAX_INITIATIVE
	}
	set_variable = {
		bar_pen_fight_ai_already_attacked = 0
	}
}



  #####  #     # ###       #     # ######  ######     #    ####### ### #     #  #####  
 #     # #     #  #        #     # #     # #     #   # #      #     #  ##    # #     # 
 #       #     #  #        #     # #     # #     #  #   #     #     #  # #   # #       
 #  #### #     #  #        #     # ######  #     # #     #    #     #  #  #  # #  #### 
 #     # #     #  #        #     # #       #     # #######    #     #  #   # # #     # 
 #     # #     #  #        #     # #       #     # #     #    #     #  #    ## #     # 
  #####   #####  ###        #####  #       ######  #     #    #    ### #     #  #####  
        
  

bar_pen_fight_gui_reload = {
	log = "[GetDateText]: [Root.GetName]: pen fight gui reload"
	BAR_fight_pentarchy_viira_initiative = yes
	BAR_fight_pentarchy_silver_initiative = yes
	BAR_fight_pentarchy_leopold_initiative = yes
	BAR_fight_pentarchy_asinti_initiative = yes
	bar_fight_viira_hp = yes
	bar_fight_silver_hp = yes
	bar_fight_leopold_hp = yes
	bar_fight_asinti_hp = yes
	add_to_variable = {
		bar_pentarchy_fight_show = 1
	}
}

bar_fight_silver_hp = {
	#hp is shown as 1 hearth == 10hp, current_hp_index shows that representation from current hp
	set_variable = {
		char_current_hp_index = s_hp
	}
	divide_variable = {
		char_current_hp_index = 10
	}
	round_variable = char_current_hp_index
	#looping thought hp and updating gui vars
	for_each_loop = {
		array = bar_fight_silver_star_hp_bar
		index = hp_index
		value = hp_frame
		set_temp_variable = {
			hp_mult_value = hp_index
		}
		multiply_temp_variable = {
			hp_mult_value = 10
		}
		if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = equals
				}
				check_variable = {
					var = s_hp
					value = hp_mult_value
					compare = not_equals
				}
			}
			set_variable = {
				bar_fight_silver_star_hp_bar^hp_index = 2
			}
		}
		else_if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = less_than_or_equals
				}
			}
			set_variable = {
				bar_fight_silver_star_hp_bar^hp_index = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_silver_star_hp_bar^hp_index = 3
			}
		}
	}
}

bar_fight_leopold_hp = {
	#hp is shown as 1 hearth == 10hp, current_hp_index shows that representation from current hp
	set_variable = {
		char_current_hp_index = l_hp
	}
	divide_variable = {
		char_current_hp_index = 10
	}
	round_variable = char_current_hp_index
	#looping thought hp and updating gui vars
	for_each_loop = {
		array = bar_fight_leopold_hp_bar
		index = hp_index
		value = hp_frame
		set_temp_variable = {
			hp_mult_value = hp_index
		}
		multiply_temp_variable = {
			hp_mult_value = 10
		}
		if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = equals
				}
				check_variable = {
					var = l_hp
					value = hp_mult_value
					compare = not_equals
				}
			}
			set_variable = {
				bar_fight_leopold_hp_bar^hp_index = 2
			}
		}
		else_if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = less_than_or_equals
				}
			}
			set_variable = {
				bar_fight_leopold_hp_bar^hp_index = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_leopold_hp_bar^hp_index = 3
			}
		}
	}
}

bar_fight_viira_hp = {
	#hp is shown as 1 hearth == 10hp, current_hp_index shows that representation from current hp
	set_variable = {
		v_current_hp_index = v_hp
	}
	divide_variable = {
		v_current_hp_index = 10
	}
	round_variable = v_current_hp_index
	#looping thought hp and updating gui vars
	for_each_loop = {
		array = bar_fight_viira_hp_bar
		index = hp_index
		value = hp_frame
		set_temp_variable = {
			hp_mult_value = hp_index
		}
		multiply_temp_variable = {
			hp_mult_value = 10
		}
		if = {
			limit = {
				check_variable = {
					var = hp_index
					value = v_current_hp_index
					compare = equals
				}
				check_variable = {
					var = v_hp
					value = hp_mult_value
					compare = not_equals
				}
			}
			set_variable = {
				bar_fight_viira_hp_bar^hp_index = 2
			}
		}
		else_if = {
			limit = {
				check_variable = {
					var = hp_index
					value = v_current_hp_index
					compare = less_than_or_equals
				}
			}
			set_variable = {
				bar_fight_viira_hp_bar^hp_index = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_viira_hp_bar^hp_index = 3
			}
		}
	}
}

bar_fight_asinti_hp = {
	#hp is shown as 1 hearth == 10hp, current_hp_index shows that representation from current hp
	set_variable = {
		char_current_hp_index = a_hp
	}
	divide_variable = {
		char_current_hp_index = 10
	}
	round_variable = char_current_hp_index
	#looping thought hp and updating gui vars
	for_each_loop = {
		array = bar_fight_asinti_hp_bar
		index = hp_index
		value = hp_frame
		set_temp_variable = {
			hp_mult_value = hp_index
		}
		multiply_temp_variable = {
			hp_mult_value = 10
		}
		if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = equals
				}
				check_variable = {
					var = a_hp
					value = hp_mult_value
					compare = not_equals
				}
			}
			set_variable = {
				bar_fight_asinti_hp_bar^hp_index = 2
			}
		}
		else_if = {
			limit = {
				check_variable = {
					var = hp_index
					value = char_current_hp_index
					compare = less_than_or_equals
				}
			}
			set_variable = {
				bar_fight_asinti_hp_bar^hp_index = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_asinti_hp_bar^hp_index = 3
			}
		}
	}
}

BAR_fight_pentarchy_leopold_initiative = {
	for_each_loop = {
		array = bar_fight_leopold_initiative_bar
		if = {
			limit = {
				check_variable = {
					l_in > i
				}
			}
			set_variable = {
				bar_fight_leopold_initiative_bar^i = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_leopold_initiative_bar^i = 2
			}
		}
	}
}

BAR_fight_pentarchy_silver_initiative = {
	for_each_loop = {
		array = bar_fight_silver_star_initiative_bar
		if = {
			limit = {
				check_variable = {
					s_in > i
				}
			}
			set_variable = {
				bar_fight_silver_star_initiative_bar^i = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_silver_star_initiative_bar^i = 2
			}
		}
	}
}

BAR_fight_pentarchy_asinti_initiative = {
	for_each_loop = {
		array = bar_fight_asinti_initiative_bar
		if = {
			limit = {
				check_variable = {
					a_in > i
				}
			}
			set_variable = {
				bar_fight_asinti_initiative_bar^i = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_asinti_initiative_bar^i = 2
			}
		}
	}
}
BAR_fight_pentarchy_viira_initiative = {
	for_each_loop = {
		array = bar_fight_viira_initiative_bar
		if = {
			limit = {
				check_variable = {
					v_in > i
				}
			}
			set_variable = {
				bar_fight_viira_initiative_bar^i = 1
			}
		}
		else = {
			set_variable = {
				bar_fight_viira_initiative_bar^i = 2
			}
		}
	}
}


    #     #####  ####### ### ####### #     #  #####  
   # #   #     #    #     #  #     # ##    # #     # 
  #   #  #          #     #  #     # # #   # #       
 #     # #          #     #  #     # #  #  #  #####  
 ####### #          #     #  #     # #   # #       # 
 #     # #     #    #     #  #     # #    ## #     # 
 #     #  #####     #    ### ####### #     #  #####  
                                                                                                             


BAR_pen_fight_silver_normal_attack = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				s_in > 0
			}
		}
		hidden_effect = {		
			random_list = {
				90 = {
					set_variable_to_random = {
						var = dmgToDeal
						min = 2
						max = 21
						integer = yes
					}
					subtract_from_variable = {
						v_hp = dmgToDeal
					}
				}
				10 = {
					set_variable = {
						bar_pen_fight_missed = 1
					}
					#you missed
				}
			}
			subtract_from_variable = {
				s_in = 1
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_silver_lifesteal_attack = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				s_in > 1
			}
			check_variable = {
				BAR_resources_silver > 49
			}
		}	
		random_list = {
			90 = {
				set_variable_to_random = {
					var = dmgToDeal
					min = 5
					max = 24
					integer = yes
				}
				subtract_from_variable = {
					v_hp = dmgToDeal
				}
				add_to_variable = {
					s_hp = dmgToDeal
				}
				if = {
					limit = {
						check_variable = {
							s_hp > @PEN_FIGHT_SILVER_STAR_MAX_HP
						}
					}
					set_variable = {
						s_hp = @PEN_FIGHT_SILVER_STAR_MAX_HP
					}
				}
			}
			10 = {
				set_variable = {
					bar_pen_fight_missed = 1
				}
				#you missed
			}
		}
		subtract_from_variable = {
			s_in = 2
		}
		subtract_from_variable = {
			BAR_resources_silver = 50
		}
		BAR_pen_fight_ai_turn = yes
	}
}

BAR_silver_heal = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				s_in > 1
			}
			check_variable = {
				BAR_resources_silver > 99
			}
		}
		set_variable_to_random = {
			var = hp_to_heal
			min = 24
			max = 42
			integer = yes
		}
		set_variable = {
			BAR_heal_prepare = 1
		}
	}
}

BAR_silver_heal_silver = {
	if = {
		limit = {
			has_variable = BAR_heal_prepare
		}
		hidden_effect = {
			add_to_variable = {
				s_hp = healAmount
			}
			if = {
				limit = {
					check_variable = {
						s_hp > @PEN_FIGHT_SILVER_STAR_MAX_HP
					}
				}
				set_variable = {
					s_hp = @PEN_FIGHT_SILVER_STAR_MAX_HP
				}
			}
			subtract_from_variable = {
				BAR_resources_silver = 100
			}
			BAR_pen_fight_ai_turn = yes
			clear_variable = BAR_heal_prepare
		}
	}
}

BAR_silver_heal_asinti = {
	if = {
		limit = {
			has_variable = BAR_heal_prepare
		}
		hidden_effect = {
			add_to_variable = {
				a_hp = healAmount
			}
			if = {
				limit = {
					check_variable = {
						a_hp > @PEN_FIGHT_ASINTI_MAX_HP
					}
				}
				set_variable = {
					a_hp = @PEN_FIGHT_ASINTI_MAX_HP
				}
			}
			subtract_from_variable = {
				BAR_resources_silver = 100
			}
			BAR_pen_fight_ai_turn = yes
			clear_variable = BAR_heal_prepare
		}
	}
}

BAR_silver_heal_leopold = {
	if = {
		limit = {
			has_variable = BAR_heal_prepare
		}
		hidden_effect = {
			add_to_variable = {
				l_hp = healAmount
			}
			if = {
				limit = {
					check_variable = {
						l_hp > @PEN_FIGHT_LEOPOLD_MAX_HP
					}
				}
				set_variable = {
					l_hp = @PEN_FIGHT_LEOPOLD_MAX_HP
				}
			}
			subtract_from_variable = {
				BAR_resources_silver = 100
			}
			BAR_pen_fight_ai_turn = yes
			clear_variable = BAR_heal_prepare
		}
	}
}

BAR_pen_fight_leopold_normal_attack = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				l_in > 0
			}
		}
		hidden_effect = {
			random_list = {
				90 = {
					set_variable_to_random = {
						var = dmgToDeal
						min = 3
						max = 22
						integer = yes
					}
					subtract_from_variable = {
						v_hp = dmgToDeal
					}
				}
				10 = {
					set_variable = {
						bar_pen_fight_missed = 2
					}
					#you missed
				}
			}
			subtract_from_variable = {
				l_in = 1
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_leopold_strong_attack = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				l_in > 2
			}
			check_variable = {
				BAR_resources_leopold > 49
			}
		}
		hidden_effect = {
			random_list = {
				90 = {
					set_variable_to_random = {
						var = dmgToDeal
						min = 11
						max = 48
						integer = yes
					}
					subtract_from_variable = {
						v_hp = dmgToDeal
					}
				}
				10 = {
					set_variable = {
						bar_pen_fight_missed = 2
					}
					#you missed
				}
			}
			subtract_from_variable = {
				l_in = 3
			}
			subtract_from_variable = {
				BAR_resources_leopold = 50
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_leopold_stun = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				l_in > 1
			}
			check_variable = {
				BAR_resources_leopold > 99
			}
		}
		hidden_effect = {
			random_list = {
				40 = {
					set_variable = {
						v_stun = 1
					}
				}
				50 = {
					set_variable = {
						v_stun = 2
					}
				}
				10 = {
					set_variable = {
						v_stun = 3
					}
				}
			}
			subtract_from_variable = {
				l_in = 2
			}
			subtract_from_variable = {
				BAR_resources_leopold = 100
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_asinti_normal_attack = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				a_in > 0
			}
		}
		hidden_effect = {	
			random_list = {
				90 = {
					set_variable_to_random = {
						var = dmgToDeal
						min = 5
						max = 22
						integer = yes
					}
					subtract_from_variable = {
						v_hp = dmgToDeal
					}
				}
				10 = {
					set_variable = {
						bar_pen_fight_missed = 3
					}
					#you missed
				}
			}
			subtract_from_variable = {
				a_in = 1
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_asinti_heal = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				a_in > 1
			}
			check_variable = {
				BAR_resources_asinti > 99
			}
		}
		hidden_effect = {	
			set_variable_to_random = {
				var = healAmount
				min = 7
				max = 17
				integer = yes
			}
			if = {
				limit = {
					has_country_flag = barrad_silver_star_alive
				}
				add_to_variable = {
					s_hp = healAmount
				}
				if = {
					limit = {
						check_variable = {
							s_hp > @PEN_FIGHT_SILVER_STAR_MAX_HP
						}
					}
					set_variable = {
						s_hp = @PEN_FIGHT_SILVER_STAR_MAX_HP
					}
				}
			}
			if = {
				limit = {
					has_country_flag = barrad_leopold_alive
				}
				add_to_variable = {
					l_hp = healAmount
				}
				if = {
					limit = {
						check_variable = {
							l_hp > @PEN_FIGHT_LEOPOLD_MAX_HP
						}
					}
					set_variable = {
						l_hp = @PEN_FIGHT_LEOPOLD_MAX_HP
					}
				}
			}
			add_to_variable = {
				a_hp = healAmount
			}
			if = {
				limit = {
					check_variable = {
						a_hp > @PEN_FIGHT_ASINTI_MAX_HP
					}
				}
				set_variable = {
					a_hp = @PEN_FIGHT_ASINTI_MAX_HP
				}
			}

			subtract_from_variable = {
				a_in = 2
			}
			subtract_from_variable = {
				BAR_resources_asinti = 100
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_asinti_debuf = {
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			check_variable = {
				a_in > 0
			}
			check_variable = {
				BAR_resources_asinti > 99
			}
		}
		hidden_effect = {
			subtract_from_variable = {
				a_in = 1
			}
			subtract_from_variable = {
				BAR_resources_asinti = 100
			}
			set_variable = {
				viira_dmg_debuff = 2
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

bar_viira_fight_normal_attack = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira normal attack"
	if = {
		limit = {
			check_variable = {
				v_stun < 1
			}
			check_variable = {
				v_in > 0
			}
		}
		set_variable_to_random = {
			var = dmgToDeal
			min = 5
			max = 24
			integer = yes
		}
		set_variable = {
			initiative_cost = 1
		}
		divide_variable = {
			dmgToDeal = viira_dmg_debuff
		}
		round_variable = dmgToDeal
		set_variable = {
			bar_viira_attack_prepared = 1
		}
	}
}

bar_viira_fight_strong_attack = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira strong attack"
	if = {
		limit = {
			check_variable = {
				v_stun < 1
			}
			check_variable = {
				v_in > 2
			}
			check_variable = {
				BAR_resources_viira > 99
			}
		}
		set_variable_to_random = {
			var = dmgToDeal
			min = 5
			max = 72
			integer = yes
		}
		set_variable = {
			initiative_cost = 3
		}
		divide_variable = {
			dmgToDeal = viira_dmg_debuff
		}
		round_variable = dmgToDeal
		set_variable = {
			bar_viira_attack_prepared = 1
		}
	}
}

bar_viira_fight_deal_dmg_asinti = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira attacks asinti"
	if = {
		limit = {
			check_variable = {
				bar_viira_attack_prepared = 1
			}
		}
		subtract_from_variable = {
			v_in = initiative_cost
		}
		subtract_from_variable = {
			a_hp = dmgToDeal
		}
		if = {
			limit = {
				check_variable = {
					a_hp < 1
				}
			}
			set_variable = {
				a_hp = 0
			}
			barrad_kill_asinti = yes
		}
		BAR_pen_fight_ai_turn = yes
		clear_variable = bar_viira_attack_prepared
	}
}

bar_viira_fight_deal_dmg_leopold = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira attacks leopold"
	if = {
		limit = {
			check_variable = {
				bar_viira_attack_prepared = 1
			}
		}
		subtract_from_variable = {
			v_in = initiative_cost
		}
		subtract_from_variable = {
			l_hp = dmgToDeal
		}
		if = {
			limit = {
				check_variable = {
					l_hp < 1
				}
			}
			set_variable = {
				l_hp = 0
			}
			barrad_kill_leopold = yes
		}
		BAR_pen_fight_ai_turn = yes
		clear_variable = bar_viira_attack_prepared
	}
}

bar_viira_fight_deal_dmg_silver = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira attacks silver star"
	if = {
		limit = {
			check_variable = {
				bar_viira_attack_prepared = 1
			}
		}
		subtract_from_variable = {
			v_in = initiative_cost
		}
		subtract_from_variable = {
			s_hp = dmgToDeal
		}
		if = {
			limit = {
				check_variable = {
					s_hp < 1
				}
			}
			set_variable = {
				s_hp = 0
			}
			barrad_kill_silver = yes
		}
		subtract_from_variable = {
			BAR_resources_viira = 100
		}
		BAR_pen_fight_ai_turn = yes
		clear_variable = bar_viira_attack_prepared
	}
}

bar_viira_fight_heal = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira heals"
	if = {
		limit = {
			check_variable = {
				v_stun < 1
			}
			check_variable = {
				v_in > 0
			}
			check_variable = {
				BAR_resources_viira > 199
			}
		}
		hidden_effect = {
			set_variable_to_random = {
				var = healVal
				min = 12
				max = 30
				integer = yes
			}
			add_to_variable = {
				v_hp = healVal
			}
			if = {
				limit = {
					check_variable = {
						v_hp > @PEN_FIGHT_VIIRA_MAX_HP
					}
				}
				set_variable = {
					v_hp = @PEN_FIGHT_VIIRA_MAX_HP
				}
			}
			subtract_from_variable = {
				v_in = 1
			}
			subtract_from_variable = {
				BAR_resources_viira = 200
			}
			BAR_pen_fight_ai_turn = yes
		}
	}
}

BAR_pen_fight_rest = {
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = bar_fight_pentarchy_side
			}
			BAR_pen_fight_rest_pentarchs = yes
		}
		else = {
			BAR_pen_fight_rest_viira = yes
		}
	}
}

BAR_pen_fight_rest_viira = {
	log = "[GetDateText]: [Root.GetName]: pen fight viira rests"
	if = {
		limit = {
			check_variable = {
				v_in < 16
			}
		}
		add_to_variable = {
			v_in = 5
		}
	}
	else = {
		set_variable = {
			v_in = 20
		}
	}
	BAR_pen_fight_ai_turn = yes
}

BAR_pen_fight_rest_pentarchs = {
	log = "[GetDateText]: [Root.GetName]: pen fight pentarchy rests"
	set_variable = {
		bar_pen_fight_missed = 0
	}
	if = {
		limit = {
			has_country_flag = barrad_asinti_alive
		}
		add_to_variable = {
			a_in = 2
		}
		if = {
			limit = {
				check_variable = {
					a_in > @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
				}
			}
			set_variable = {
				a_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
			}
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_leopold_alive
		}
		add_to_variable = {
			l_in = 2
		}
		if = {
			limit = {
				check_variable = {
					l_in > @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
				}
			}
			set_variable = {
				l_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
			}
		}
	}
	if = {
		limit = {
			has_country_flag = barrad_silver_star_alive
		}
		add_to_variable = {
			s_in = 2
		}
		if = {
			limit = {
				check_variable = {
					s_in > @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
				}
			}
			set_variable = {
				s_in = @PEN_FIGHT_PENTARCHY_MAX_INITIATIVE
			}
		}
	}
	BAR_pen_fight_ai_turn = yes
}



    #    ###    ####### #     # ######  #     #  #####  
   # #    #        #    #     # #     # ##    # #     # 
  #   #   #        #    #     # #     # # #   # #       
 #     #  #        #    #     # ######  #  #  #  #####  
 #######  #        #    #     # #   #   #   # #       # 
 #     #  #        #    #     # #    #  #    ## #     # 
 #     # ###       #     #####  #     # #     #  #####  



BAR_pen_fight_ai_turn = {
	if = {
		limit = {
			check_variable = {
				bar_pen_fight_ai_already_attacked = 0
			}
		}
		set_variable = {
			bar_pen_fight_ai_already_attacked = 1
		}
		if = {
			limit = {
				has_country_flag = bar_fight_pentarchy_side
			}
			log = "[GetDateText]: [Root.GetName]: pen fight viira next round"
			if = {
				limit = {
					check_variable = {
						v_hp > 0
					}
				}
				BAR_viira_turn = yes
				if = {
					limit = {	
						NOT = {
							has_country_flag = barrad_asinti_alive
							has_country_flag = barrad_leopold_alive
							has_country_flag = barrad_silver_star_alive
						}
					}
					#we lost...
					country_event = {
						id = barrad_viira_fight.6
					}
				}
			}
			else = {
				barrad_kill_viira = yes
				country_event = {
					id = barrad_viira_fight.7
				}
				#we won!
			}
		}
		if = {
			limit = {
				has_country_flag = bar_fight_viira_side
			}
			log = "[GetDateText]: [Root.GetName]: pen fight pentarchy next round"
			if = {
				limit = {
					check_variable = {
						v_hp > 0
					}
				}
				BAR_pentarchy_turn = yes
			} else = {
				country_event = {
					id = barrad_viira_fight.9
				}
			}
		}
		bar_pen_fight_gui_reload = yes
	}

	set_variable = {
		bar_pen_fight_ai_already_attacked = 0
	}
}

BAR_viira_turn = {
	random_list = {
		50 = {
			#target weakest one
			set_temp_variable = {
				min = 1000
			}
			set_variable = {
				viira_target = 0
			}
			if = {
				limit = {
					check_variable = {
						a_hp > 0
					}
					check_variable = {
						a_hp < min
					}
				}
				set_variable = {
					min = a_hp
				}
				set_variable = {
					viira_target = 1
				}
			}
			if = {
				limit = {
					check_variable = {
						l_hp > 0
					}
					check_variable = {
						l_hp < min
					}
				}
				set_variable = {
					min = l_hp
				}
				set_variable = {
					viira_target = 2
				}
			}
			if = {
				limit = {
					check_variable = {
						s_hp > 0
					}
					check_variable = {
						s_hp < min
					}
				}
				set_variable = {
					min = s_hp
				}
				set_variable = {
					viira_target = 3
				}
			}
		}
		50 = {
			#target random one
			if = {
				limit = {
					has_country_flag = barrad_silver_star_alive
					has_country_flag = barrad_asinti_alive
					has_country_flag = barrad_leopold_alive
				}
				random_list = {
					34 = {
						set_variable = {
							viira_target = 1
						}
					}
					33 = {
						set_variable = {
							viira_target = 2
						}
					}
					33 = {
						set_variable = {
							viira_target = 3
						}
					}
				}
			}
			else_if = {
				limit = {
					has_country_flag = barrad_silver_star_alive
					has_country_flag = barrad_asinti_alive
					NOT = {
						has_country_flag = barrad_leopold_alive
					}
				}
				random_list = {
					50 = {
						set_variable = {
							viira_target = 1
						}
					}
					50 = {
						set_variable = {
							viira_target = 3
						}
					}
				}
			}
			else_if = {
				limit = {
					has_country_flag = barrad_silver_star_alive
					NOT = {
						has_country_flag = barrad_asinti_alive
					}
					has_country_flag = barrad_leopold_alive
				}
				random_list = {
					50 = {
						set_variable = {
							viira_target = 2
						}
					}
					50 = {
						set_variable = {
							viira_target = 3
						}
					}
				}
			}
			else_if = {
				limit = {
					has_country_flag = barrad_silver_star_alive
					NOT = {
						has_country_flag = barrad_asinti_alive
					}
					NOT = {
						has_country_flag = barrad_leopold_alive
					}
				}
				set_variable = {
					viira_target = 3
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_country_flag = barrad_silver_star_alive
					}
					has_country_flag = barrad_asinti_alive
					has_country_flag = barrad_leopold_alive
				}
				random_list = {
					50 = {
						set_variable = {
							viira_target = 1
						}
					}
					50 = {
						set_variable = {
							viira_target = 2
						}
					}
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_country_flag = barrad_silver_star_alive
					}
					has_country_flag = barrad_asinti_alive
					NOT = {
						has_country_flag = barrad_leopold_alive
					}
				}
				set_variable = {
					viira_target = 1
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_country_flag = barrad_silver_star_alive
					}
					NOT = {
						has_country_flag = barrad_asinti_alive
					}
					has_country_flag = barrad_leopold_alive
				}
				set_variable = {
					viira_target = 2
				}
			}
		}
	}
	if = {
		limit = {
			check_variable = {
				v_stun < 1
			}
		}
		BAR_viira_attack = yes
	}
	else = {
		set_variable = {
			BAR_fight_pentarchy_action_log = 5
		}
		subtract_from_variable = {
			v_stun = 1
		}
	}
	set_variable = {
		viira_dmg_debuff = 1
	}
}

BAR_viira_attack = {
	set_temp_variable = {
		v_hp_half = v_hp
	}
	set_temp_variable = {
		v_hp_qua = v_hp
	}
	divide_temp_variable = {
		v_hp_half = 2
	}
	divide_temp_variable = {
		v_hp_qua = 4
	}
	if = {
		limit = {
			check_variable = {
				v_in > 10
			}
		}
		if = {
			limit = {
				check_variable = {
					var = v_hp
					value = v_hp_half
					compare = greater_than_or_equals
				}
			}
			random_list = {
				70 = {
					bar_viira_fight_strong_attack = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 2
					}
				}
				30 = {
					bar_viira_fight_normal_attack = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 1
					}
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					v_hp < v_hp_qua
				}
			}
			random_list = {
				50 = {
					bar_viira_fight_heal = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 3
					}
				}
				50 = {
					bar_viira_fight_strong_attack = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 2
					}
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					v_hp < v_hp_half
				}
			}
			random_list = {
				30 = {
					bar_viira_fight_heal = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 3
					}
				}
				70 = {
					bar_viira_fight_strong_attack = yes
					set_variable = {
						BAR_fight_pentarchy_action_log = 2
					}
				}
			}
		}
	}
	else = {
		if = {
			#rest
			limit = {
				check_variable = {
					v_in = 0
				}
			}
			BAR_pen_fight_rest_viira = yes
		}
		else = {
			if = {
				limit = {
					check_variable = {
						var = v_hp
						value = v_hp_half
						compare = greater_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {
							v_in > 2
						}
					}
					random_list = {
						60 = {
							BAR_pen_fight_rest_viira = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 4
							}
						}
						20 = {
							bar_viira_fight_normal_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 1
							}
						}
						20 = {
							bar_viira_fight_strong_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 2
							}
						}
					}
				}
				else = {
					random_list = {
						60 = {
							BAR_pen_fight_rest_viira = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 4
							}
						}
						40 = {
							bar_viira_fight_normal_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 1
							}
						}
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						v_hp < v_hp_qua
					}
				}
				if = {
					limit = {
						check_variable = {
							v_in > 2
						}
					}
					random_list = {
						50 = {
							bar_viira_fight_heal = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 3
							}
						}
						50 = {
							bar_viira_fight_strong_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 2
							}
						}
					}
				}
				else = {
					random_list = {
						50 = {
							bar_viira_fight_heal = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 3
							}
						}
						50 = {
							bar_viira_fight_normal_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 1
							}
						}
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						v_hp < v_hp_half
					}
				}
				if = {
					limit = {
						check_variable = {
							v_in > 2
						}
					}
					random_list = {
						30 = {
							bar_viira_fight_heal = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 3
							}
						}
						20 = {
							bar_viira_fight_normal_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 1
							}
						}
						20 = {
							bar_viira_fight_strong_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 2
							}
						}
						30 = {
							BAR_pen_fight_rest_viira = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 4
							}
						}
					}
				}
				else = {
					random_list = {
						30 = {
							bar_viira_fight_heal = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 3
							}
						}
						40 = {
							bar_viira_fight_strong_attack = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 2
							}
						}
						30 = {
							BAR_pen_fight_rest_viira = yes
							set_variable = {
								BAR_fight_pentarchy_action_log = 4
							}
						}
					}
				}
			}
		}
	}

	if = {
		limit = {
			check_variable = {
				viira_target = 1
			}
		}
		bar_viira_fight_deal_dmg_asinti = yes
	}
	if = {
		limit = {
			check_variable = {
				viira_target = 2
			}
		}
		bar_viira_fight_deal_dmg_leopold = yes
	}
	if = {
		limit = {
			check_variable = {
				viira_target = 3
			}
		}
		bar_viira_fight_deal_dmg_silver = yes
	}
	clear_variable = viira_target
}

BAR_pentarchy_turn = {
	if = {
		limit = {
			OR = {
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_asinti_alive
				has_country_flag = barrad_leopold_alive
			}
		}
		if = {
			limit = {
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_asinti_alive
				has_country_flag = barrad_leopold_alive
			}
			random_list = {
				34 = {
					set_variable = {
						character_attacking = 1
					}
				}
				33 = {
					set_variable = {
						character_attacking = 2
					}
				}
				33 = {
					set_variable = {
						character_attacking = 3
					}
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = barrad_silver_star_alive
				has_country_flag = barrad_asinti_alive
				NOT = {
					has_country_flag = barrad_leopold_alive
				}
			}
			random_list = {
				50 = {
					set_variable = {
						character_attacking = 1
					}
				}
				50 = {
					set_variable = {
						character_attacking = 3
					}
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = barrad_silver_star_alive
				NOT = {
					has_country_flag = barrad_asinti_alive
				}
				has_country_flag = barrad_leopold_alive
			}
			random_list = {
				50 = {
					set_variable = {
						character_attacking = 2
					}
				}
				50 = {
					set_variable = {
						character_attacking = 3
					}
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = barrad_silver_star_alive
				NOT = {
					has_country_flag = barrad_asinti_alive
				}
				NOT = {
					has_country_flag = barrad_leopold_alive
				}
			}
			set_variable = {
				character_attacking = 3
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_country_flag = barrad_silver_star_alive
				}
				has_country_flag = barrad_asinti_alive
				has_country_flag = barrad_leopold_alive
			}
			random_list = {
				50 = {
					set_variable = {
						character_attacking = 1
					}
				}
				50 = {
					set_variable = {
						character_attacking = 2
					}
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_country_flag = barrad_silver_star_alive
				}
				has_country_flag = barrad_asinti_alive
				NOT = {
					has_country_flag = barrad_leopold_alive
				}
			}
			set_variable = {
				character_attacking = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_country_flag = barrad_silver_star_alive
				}
				NOT = {
					has_country_flag = barrad_asinti_alive
				}
				has_country_flag = barrad_leopold_alive
			}
			set_variable = {
				character_attacking = 2
			}
		}

		if = {
			#asinti
			limit = {
				check_variable = {
					character_attacking = 1
				}
			}
			BAR_asinti_turn = yes
		}
		if = {
			#leopold
			limit = {
				check_variable = {
					character_attacking = 2
				}
			}
			BAR_leopold_turn = yes
		}
		if = {
			#silver
			limit = {
				check_variable = {
					character_attacking = 3
				}
			}
			BAR_silver_turn = yes
		}
	}
	else = {
		#viira won
		country_event = {
			id = barrad_viira_fight.10
		}
	}

	if = {
		limit = {
			check_variable = {
				v_stun > 0
			}
		}
		subtract_from_variable = {
			v_stun = 1
		}
		BAR_pen_fight_ai_turn = yes
	}
}

BAR_asinti_turn = {
	log = "[GetDateText]: [Root.GetName]: pentarchy turn asinti attack"
	set_temp_variable = {
		a_hp_half = a_hp
	}
	set_temp_variable = {
		a_hp_qua = a_hp
	}
	divide_temp_variable = {
		a_hp_half = 2
	}
	divide_temp_variable = {
		a_hp_qua = 4
	}
	if = {
		limit = {
			check_variable = {
				a_in > 5
			}
		}
		if = {
			limit = {
				check_variable = {
					var = a_hp
					value = a_hp_half
					compare = greater_than_or_equals
				}
			}
			random_list = {
				70 = {
					BAR_pen_fight_asinti_normal_attack = yes
				}
				30 = {
					BAR_pen_fight_asinti_debuf = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					a_hp < a_hp_qua
				}
			}
			random_list = {
				40 = {
					BAR_pen_fight_asinti_normal_attack = yes
				}
				20 = {
					BAR_pen_fight_asinti_debuf = yes
				}
				40 = {
					BAR_pen_fight_asinti_heal = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					a_hp < a_hp_half
				}
			}
			random_list = {
				50 = {
					BAR_pen_fight_asinti_normal_attack = yes
				}
				30 = {
					BAR_pen_fight_asinti_debuf = yes
				}
				20 = {
					BAR_pen_fight_asinti_heal = yes
				}
			}
		}
	}
	else = {
		if = {
			#rest
			limit = {
				check_variable = {
					a_in = 0
				}
			}
			BAR_pen_fight_rest = yes
			set_variable = {
				BAR_fight_pentarchy_action_log = 4
			}
		}
		else = {
			if = {
				limit = {
					check_variable = {
						var = a_hp
						value = a_hp_half
						compare = greater_than_or_equals
					}
				}
				random_list = {
					60 = {
						BAR_pen_fight_asinti_normal_attack = yes
					}
					40 = {
						BAR_pen_fight_rest = yes
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						a_hp < a_hp_qua
					}
				}
				if = {
					limit = {
						check_variable = {
							a_in > 1
						}
					}
					random_list = {
						20 = {
							BAR_pen_fight_asinti_normal_attack = yes
						}
						40 = {
							BAR_pen_fight_asinti_heal = yes
						}
						40 = {
							BAR_pen_fight_rest = yes
						}
					}
				}
				else = {
					random_list = {
						70 = {
							BAR_pen_fight_asinti_normal_attack = yes
						}
						30 = {
							BAR_pen_fight_rest = yes
						}
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						a_hp < a_hp_half
					}
				}
				if = {
					limit = {
						check_variable = {
							a_in > 1
						}
					}
					random_list = {
						40 = {
							BAR_pen_fight_asinti_normal_attack = yes
						}
						20 = {
							BAR_pen_fight_asinti_heal = yes
						}
						40 = {
							BAR_pen_fight_rest = yes
						}
					}
				}
				else = {
					60 = {
						BAR_pen_fight_asinti_normal_attack = yes
					}
					40 = {
						BAR_pen_fight_rest = yes
					}
				}
			}
		}
	}
}

BAR_leopold_turn = {
	log = "[GetDateText]: [Root.GetName]: pentarchy turn leopold attack"
	set_temp_variable = {
		l_hp_half = l_hp
	}
	set_temp_variable = {
		l_hp_qua = l_hp
	}
	divide_temp_variable = {
		l_hp_half = 2
	}
	divide_temp_variable = {
		l_hp_qua = 4
	}
	if = {
		limit = {
			check_variable = {
				l_in > 5
			}
		}
		if = {
			limit = {
				check_variable = {
					var = l_hp
					value = l_hp_half
					compare = greater_than_or_equals
				}
			}
			random_list = {
				30 = {
					BAR_pen_fight_leopold_normal_attack = yes
				}
				60 = {
					BAR_pen_fight_leopold_strong_attack = yes
				}
				10 = {
					BAR_pen_fight_leopold_stun = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					l_hp < l_hp_qua
				}
			}
			random_list = {
				80 = {
					BAR_pen_fight_leopold_strong_attack = yes
				}
				20 = {
					BAR_pen_fight_leopold_stun = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					l_hp < l_hp_half
				}
			}
			random_list = {
				20 = {
					BAR_pen_fight_leopold_normal_attack = yes
				}
				70 = {
					BAR_pen_fight_leopold_strong_attack = yes
				}
				10 = {
					BAR_pen_fight_leopold_stun = yes
				}
			}
		}
	}
	else = {
		if = {
			#rest
			limit = {
				check_variable = {
					l_in = 0
				}
			}
			BAR_pen_fight_rest = yes
		}
		else = {
			if = {
				limit = {
					check_variable = {
						var = a_hp
						value = a_hp_half
						compare = greater_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {
							l_in > 2
						}
					}
					random_list = {
						70 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						20 = {
							BAR_pen_fight_leopold_strong_attack = yes
						}
						10 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
				else = {
					random_list = {
						80 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						20 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						l_hp < l_hp_qua
					}
				}
				if = {
					limit = {
						check_variable = {
							l_in > 2
						}
					}
					random_list = {
						90 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						10 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
				else = {
					random_list = {
						80 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						20 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
			}
			if = {
				limit = {
					check_variable = {
						l_hp < l_hp_half
					}
				}
				if = {
					limit = {
						check_variable = {
							l_in > 2
						}
					}
					random_list = {
						70 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						20 = {
							BAR_pen_fight_leopold_strong_attack = yes
						}
						10 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
				else = {
					random_list = {
						90 = {
							BAR_pen_fight_leopold_normal_attack = yes
						}
						10 = {
							BAR_pen_fight_leopold_stun = yes
						}
					}
				}
			}
		}
	}
}

BAR_silver_turn = {
	log = "[GetDateText]: [Root.GetName]: pentarchy turn silver star attack"
	set_temp_variable = {
		s_hp_half = s_hp
	}
	set_temp_variable = {
		s_hp_qua = s_hp
	}
	divide_temp_variable = {
		s_hp_half = 2
	}
	divide_temp_variable = {
		s_hp_qua = 4
	}
	if = {
		limit = {
			check_variable = {
				s_in > 5
			}
		}
		if = {
			limit = {
				check_variable = {
					var = s_hp
					value = s_hp_half
					compare = greater_than_or_equals
				}
			}
			random_list = {
				80 = {
					BAR_pen_fight_silver_normal_attack = yes
				}
				20 = {
					BAR_silver_turn_heal = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					s_hp < s_hp_qua
				}
			}
			random_list = {
				40 = {
					BAR_pen_fight_silver_normal_attack = yes
				}
				30 = {
					BAR_pen_fight_silver_lifesteal_attack = yes
				}
				30 = {
					BAR_silver_turn_heal = yes
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					s_hp < s_hp_half
				}
			}
			random_list = {
				60 = {
					BAR_pen_fight_silver_normal_attack = yes
				}
				20 = {
					BAR_pen_fight_silver_lifesteal_attack = yes
				}
				20 = {
					BAR_silver_turn_heal = yes
				}
			}
		}
		else_if = {
			#rest
			limit = {
				check_variable = {
					s_in = 0
				}
			}
			BAR_pen_fight_rest = yes
		}
		else = {
			if = {
				limit = {
					check_variable = {
						var = s_hp
						value = s_hp_half
						compare = greater_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {
							s_in > 1
						}
					}
					random_list = {
						90 = {
							BAR_pen_fight_silver_normal_attack = yes
						}
						10 = {
							BAR_silver_turn_heal = yes
						}
					}
				}
				else = {
					BAR_pen_fight_silver_normal_attack = yes
				}
			}
			if = {
				limit = {
					check_variable = {
						s_hp < s_hp_qua
					}
				}
				if = {
					limit = {
						check_variable = {
							s_in > 1
						}
					}
					random_list = {
						60 = {
							BAR_pen_fight_silver_normal_attack = yes
						}
						30 = {
							BAR_pen_fight_silver_lifesteal_attack = yes
						}
						10 = {
							BAR_silver_turn_heal = yes
						}
					}
				}
				else = {
					BAR_pen_fight_silver_normal_attack = yes
				}
			}
			if = {
				limit = {
					check_variable = {
						s_hp < s_hp_half
					}
				}
				if = {
					limit = {
						check_variable = {
							s_in > 1
						}
					}
					random_list = {
						80 = {
							BAR_pen_fight_silver_normal_attack = yes
						}
						10 = {
							BAR_pen_fight_silver_lifesteal_attack = yes
						}
						10 = {
							BAR_silver_turn_heal = yes
						}
					}
				}
				else = {
					BAR_pen_fight_silver_normal_attack = yes
				}
			}
		}
	}
}

BAR_silver_turn_heal = {
	BAR_silver_heal = yes
	set_temp_variable = {
		min = 1000
	}	
	if = {
		limit = {
			check_variable = {
				l_hp > 0
			}
			check_variable = {
				l_hp < min
			}
		}
		set_variable = {
			min = l_hp
		}
		BAR_silver_heal_leopold = yes
		set_variable = {
			BAR_fight_pentarchy_action_log = 10
		}
	}
	if = {
		limit = {
			check_variable = {
				a_hp > 0
			}
			check_variable = {
				a_hp < min
			}
		}
		set_variable = {
			min = a_hp
		}
		BAR_silver_heal_asinti = yes
		set_variable = {
			BAR_fight_pentarchy_action_log = 11
		}
	}
	if = {
		limit = {
			check_variable = {
				s_hp > 0
			}
			check_variable = {
				s_hp < min
			}
		}
		set_variable = {
			BAR_fight_pentarchy_action_log = 12
		}
		BAR_silver_heal_silver = yes
	}
}

#clears variables used in fight
bar_pen_fight_close_window = {
	clear_variable = BAR_fight_pentarchy_action_log
	clear_variable = a_hp
	clear_variable = a_in
	clear_variable = l_hp
	clear_variable = l_in
	clear_variable = s_hp
	clear_variable = s_in
	clear_variable = v_hp
	clear_variable = v_in
	clear_variable = character_attacking
	clear_variable = viira_dmg_debuff
	clear_variable = v_stun
	clear_variable = bar_pentarchy_fight_show
	clear_variable = bar_pen_fight_ai_already_attacked
}
